<!DOCTYPE html>
<html>

	<head>
		
		<title>Geo Example</title>
		
		<style>
			
			html, body {
				height: 100%;
				margin: 0;
				padding: 0;
			}
			
			#map {
				height: 100%;
			}
			
		</style>
		
	</head>

	<body>

    		<div id="map"></div>
		
		<script>
			
			var urlParams = new URLSearchParams(window.location.search);
			var JSElement = document.createElement('script');
			JSElement.src = "https://maps.googleapis.com/maps/api/js?key=" + urlParams.get('token');// + "&callback=initMap";
			JSElement.defer = true;
			JSElement.onload = initMap;
			document.getElementsByTagName('head')[0].appendChild(JSElement);
			
			function readTextFile(file, callback) {
				var rawFile = new XMLHttpRequest();
				rawFile.overrideMimeType("application/json");
				rawFile.open("GET", file, true);
				rawFile.onreadystatechange = function() {
					if (rawFile.readyState === 4 && rawFile.status == "200") {
						callback(rawFile.responseText);
					}
				}
				rawFile.send(null);
			}
			
			function initMap() {
				
				var map = new google.maps.Map(document.getElementById('map'), {
					zoom: 4,
					center: {lng: -98.5556199, lat: 39.8097343},
					mapTypeId: 'terrain'
				});
			
				var locations = [
					[662, 525, 532, 790, 644], // cell 1
					[583, 634, 524, 520, 635],     // cell 2
					[800, 512, 537, 716, 692]  // cell 3
				];
				
				readTextFile("dmaData.json", function(text){
					var dmaData = JSON.parse(text);
					for (var locationList of locations) {
						for (var location of locationList) {
							var geoData = dmaData.features.filter(function(data) { 
								return data.properties.dma == location 
							});
							if (geoData.length == 1) {
								map.data.addGeoJson(geoData[0]);
// 								addShape(map, geoData[0]);
							} else if (geoData.length == 0) {
								console.log('no dmas found for ' + location);
							} else {
								console.log('multiple dmas found for ' + location);
							}
							
						}
					}
				});
				
				map.data.setStyle(function(feature) {
					var dma = feature.properties.dma;
					var colors = ['red', 'blue', 'green'];
					for (var i = 0; i < locations.length; i++) {
						if (locations[i].contains(dma)) {
							return {
								fillColor: colors[i],
								strokeWeight: 1
							}
						}
					}
					return {
						fillColor: 'gray',
						strokeWeight: 1
					}
				});

			}
			
		</script>
		
	</body>

</html>
