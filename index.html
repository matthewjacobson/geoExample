<!DOCTYPE html>
<html>

	<head>
		
		<title>Geo Example</title>
		
		<style>
			
			html, body {
				height: 100%;
				margin: 0;
				padding: 0;
			}
			
			#map {
				height: 100%;
			}
			
		</style>
		
	</head>

	<body>

		<div id="map"></div>
		
		<script>
			
			var urlParams = new URLSearchParams(window.location.search);
			var JSElement = document.createElement('script');
			JSElement.src = "https://maps.googleapis.com/maps/api/js?key=" + urlParams.get('token');// + "&callback=initMap";
			JSElement.defer = true;
			JSElement.onload = initMap;
			document.getElementsByTagName('head')[0].appendChild(JSElement);
			
			function readTextFile(file, callback) {
				var rawFile = new XMLHttpRequest();
				rawFile.overrideMimeType("application/json");
				rawFile.open("GET", file, true);
				rawFile.onreadystatechange = function() {
					if (rawFile.readyState === 4 && rawFile.status == "200") {
						callback(rawFile.responseText);
					}
				}
				rawFile.send(null);
			}
			
			function initMap() {
				
				var map = new google.maps.Map(document.getElementById('map'), {
					zoom: 4,
					center: {lng: -98.5556199, lat: 39.8097343},
					mapTypeId: 'terrain'
				});
				
// 				var locationType = 'DMA';
// 				var locations = [
// 					[662, 790, 634, 635, 537, 821, 502, 757, 514, 767, 519, 584, 602, 598, 546, 535, 623, 751, 606, 565, 802, 513, 670, 798, 755, 545, 636, 533, 618, 527, 561, 603, 702, 643, 839, 722, 529, 669, 813, 528, 687, 628, 570, 501, 633, 534, 804, 675, 508, 552, 560, 556, 611, 576, 641, 855, 657, 725, 619, 609, 539, 605, 789, 709, 625, 705, 627, 550, 771],	// cell 1
// 					[525, 644, 524, 800, 716, 756, 630, 506, 523, 637, 564, 575, 868, 510, 604, 673, 682, 679, 676, 516, 649, 866, 509, 773, 658, 567, 566, 710, 691, 718, 574, 616, 582, 551, 541, 693, 651, 737, 640, 617, 762, 828, 659, 544, 650, 631, 656, 504, 820, 521, 764, 573, 610, 770, 825, 507, 612, 588, 543, 555, 581, 540, 671, 526, 511, 548, 678, 810, 596],	// cell 2
// 					[532, 583, 520, 512, 692, 746, 559, 736, 754, 648, 517, 759, 515, 752, 522, 600, 542, 505, 765, 801, 724, 571, 592, 563, 518, 647, 569, 766, 758, 639, 734, 557, 642, 749, 558, 803, 503, 553, 711, 613, 686, 698, 622, 740, 652, 632, 597, 753, 500, 717, 811, 538, 862, 661, 807, 819, 624, 881, 638, 530, 547, 531, 760, 626, 549, 554, 577, 536]		// cell 3
// 				];
				
				var locationType = 'COUNTY';
				var locations = [
					[943, 951, 959, 967, 975, 983, 991, 999, 1007, 1015, 1023, 1031, 1039, 1047, 1055, 1063, 1071, 1079, 1087, 1095, 1103, 1111, 1119, 1127, 1135, 1143, 1151, 1159, 1167, 1175, 1183, 1191, 1199, 1207, 1215, 1223, 1231, 1239, 1247, 1255, 1263, 1271, 1279, 1287, 1295, 1303, 1311, 1319, 1327, 1335, 1343, 1351, 1359, 1367, 1375, 1383, 1391, 1399, 1407, 1415, 1423, 1431, 1439, 1447, 1455, 1463, 1471, 1479, 1487, 1495, 1503, 1511, 1519, 1527, 1535, 1543, 1551, 1559, 1567, 1575, 1583, 1591, 1599, 1607, 1615, 1623, 1631, 1639, 1647, 1655, 1663, 1671, 1679, 1687, 1695, 1703, 1711, 1719, 1727, 1735, 1743, 1751, 1759, 1767, 1775, 1783, 1791, 1799, 1807, 1815, 1823, 1831, 1839, 1847, 1855, 1863, 1871, 1879, 1887, 1895, 1903, 1911, 1919, 1927, 1935, 1943, 1951, 1959, 1967, 1975, 1983, 1991, 1999, 2007, 2015, 2023, 2031, 2039, 2047, 2055, 2063, 2071, 2079, 2087, 2095, 2103, 2111, 2119, 2127, 2135, 2143, 2151, 2159, 2167, 2175, 2183, 2191, 2199, 2207, 2215, 2223, 2231, 2239, 2247, 2255, 2263, 2271, 2279, 2287, 2295, 2303, 2311, 2319, 2327, 2335, 2343, 2351, 2359, 2367, 2375, 2383, 2391, 2399, 2407, 2415, 2423, 2431, 2439, 2447, 2455, 2463, 2471, 2479, 2487, 2495, 2503, 2511, 2519, 2527, 2535, 2543, 2551, 2559, 2567, 2575, 2583, 2591, 2599, 2607, 2615, 2623, 2631, 2639, 2647, 2655, 2663, 2671, 2679, 2687, 2695, 2703, 2711, 2719, 2727, 2735, 2743, 2751, 2759, 2767, 2775, 2783, 2791, 2799, 2807, 2815, 2823, 2831, 2839, 2847, 2855, 2863, 2871, 2879, 2887, 2895, 2903, 2911, 2919, 2927, 2935, 2943, 2951, 2959, 2967, 2975, 2983, 2991, 2999, 3007, 3015, 3023, 3031, 3039, 3047, 3055, 3063, 3071, 3079, 3087, 3095, 3103, 3111, 3119, 3127, 3135, 3143, 3151, 3159, 3167, 3175, 3183, 3191, 3199, 3207, 3215, 3223, 3231, 3239, 3247, 3255, 3263, 3271, 3279, 3287, 3295, 3303, 3311, 3319, 3327, 3335, 3343, 3351, 3359, 3367, 3375, 3383, 3391, 3399, 3407, 3415, 3423, 3431, 3439, 3447, 3455, 3463, 3471, 3479, 3487, 3495, 3503, 3511, 3519, 3527, 3535, 3543, 3551, 3559, 3567, 3575, 3583, 3591, 3599],	// cell 1
					[3607, 3615, 3623, 3631, 3639, 3647, 3655, 3663, 3671, 3679, 3687, 3695, 3703, 3711, 3719, 3727, 3735, 3743, 3751, 3759, 3767, 3775, 3783, 3791, 3799, 3807, 3815, 3823, 3831, 3839, 3847, 3855, 3863, 3871, 3879, 3887, 3895, 3903, 3911, 3919, 3927, 3935, 3943, 3951, 3959, 3967, 3975, 3983, 3991, 3999, 4007, 4015, 4023, 4031, 941, 949, 957, 965, 973, 981, 989, 997, 1005, 1013, 1021, 1029, 1037, 1045, 1053, 1061, 1069, 1077, 1085, 1093, 1101, 1109, 1117, 1125, 1133, 1141, 1149, 1157, 1165, 1173, 1181, 1189, 1197, 1205, 1213, 1221, 1229, 1237, 1245, 1253, 1261, 1269, 1277, 1285, 1293, 1301, 1309, 1317, 1325, 1333, 1341, 1349, 1357, 1365, 1373, 1381, 1389, 1397, 1405, 1413, 1421, 1429, 1437, 1445, 1453, 1461, 1469, 1477, 1485, 1493, 1501, 1509, 1517, 1525, 1533, 1541, 1549, 1557, 1565, 1573, 1581, 1589, 1597, 1605, 1613, 1621, 1629, 1637, 1645, 1653, 1661, 1669, 1677, 1685, 1693, 1701, 1709, 1717, 1725, 1733, 1741, 1749, 1757, 1765, 1773, 1781, 1789, 1797, 1805, 1813, 1821, 1829, 1837, 1845, 1853, 1861, 1869, 1877, 1885, 1893, 1901, 1909, 1917, 1925, 1933, 1941, 1949, 1957, 1965, 1973, 1981, 1989, 1997, 2005, 2013, 2021, 2029, 2037, 2045, 2053, 2061, 2069, 2077, 2085, 2093, 2101, 2109, 2117, 2125, 2133, 2141, 2149, 2157, 2165, 2173, 2181, 2189, 2197, 2205, 2213, 2221, 2229, 2237, 2245, 2253, 2261, 2269, 2277, 2285, 2293, 2301, 2309, 2317, 2325, 2333, 2341, 2349, 2357, 2365, 2373, 2381, 2389, 2397, 2405, 2413, 2421, 2429, 2437, 2445, 2453, 2461, 2469, 2477, 2485, 2493, 2501, 2509, 2517, 2525, 2533, 2541, 2549, 2557, 2565, 2573, 2581, 2589, 2597, 2605, 2613, 2621, 2629, 2637, 2645, 2653, 2661, 2669, 2677, 2685, 2693, 2701, 2709, 2717, 2725, 2733, 2741, 2749, 2757, 2765, 2773, 2781, 2789, 2797, 2805, 2813, 2821, 2829, 2837, 2845, 2853, 2861, 2869, 2877, 2885, 2893, 2901, 2909, 2917, 2925, 2933, 2941, 2949, 2957, 2965, 2973, 2981, 2989, 2997, 3005, 3013, 3021, 3029, 3037, 3045, 3053, 3061, 3069, 3077, 3085, 3093, 3101, 3109, 3117, 3125, 3133, 3141, 3149, 3157, 3165],	// cell 2
					[3173, 3181, 3189, 3197, 3205, 3213, 3221, 3229, 3237, 3245, 3253, 3261, 3269, 3277, 3285, 3293, 3301, 3309, 3317, 3325, 3333, 3341, 3349, 3357, 3365, 3373, 3381, 3389, 3397, 3405, 3413, 3421, 3429, 3437, 3445, 3453, 3461, 3469, 3477, 3485, 3493, 3501, 3509, 3517, 3525, 3533, 3541, 3549, 3557, 3565, 3573, 3581, 3589, 3597, 3605, 3613, 3621, 3629, 3637, 3645, 3653, 3661, 3669, 3677, 3685, 3693, 3701, 3709, 3717, 3725, 3733, 3741, 3749, 3757, 3765, 3773, 3781, 3789, 3797, 3805, 3813, 3821, 3829, 3837, 3845, 3853, 3861, 3869, 3877, 3885, 3893, 3901, 3909, 3917, 3925, 3933, 3941, 3949, 3957, 3965, 3973, 3981, 3989, 3997, 4005, 4013, 4021, 4029, 942, 950, 958, 966, 974, 982, 990, 998, 1006, 1014, 1022, 1030, 1038, 1046, 1054, 1062, 1070, 1078, 1086, 1094, 1102, 1110, 1118, 1126, 1134, 1142, 1150, 1158, 1166, 1174, 1182, 1190, 1198, 1206, 1214, 1222, 1230, 1238, 1246, 1254, 1262, 1270, 1278, 1286, 1294, 1302, 1310, 1318, 1326, 1334, 1342, 1350, 1358, 1366, 1374, 1382, 1390, 1398, 1406, 1414, 1422, 1430, 1438, 1446, 1454, 1462, 1470, 1478, 1486, 1494, 1502, 1510, 1518, 1526, 1534, 1542, 1550, 1558, 1566, 1574, 1582, 1590, 1598, 1606, 1614, 1622, 1630, 1638, 1646, 1654, 1662, 1670, 1678, 1686, 1694, 1702, 1710, 1718, 1726, 1734, 1742, 1750, 1758, 1766, 1774, 1782, 1790, 1798, 1806, 1814, 1822, 1830, 1838, 1846, 1854, 1862, 1870, 1878, 1886, 1894, 1902, 1910, 1918, 1926, 1934, 1942, 1950, 1958, 1966, 1974, 1982, 1990, 1998, 2006, 2014, 2022, 2030, 2038, 2046, 2054, 2062, 2070, 2078, 2086, 2094, 2102, 2110, 2118, 2126, 2134, 2142, 2150, 2158, 2166, 2174, 2182, 2190, 2198, 2206, 2214, 2222, 2230, 2238, 2246, 2254, 2262, 2270, 2278, 2286, 2294, 2302, 2310, 2318, 2326, 2334, 2342, 2350, 2358, 2366, 2374, 2382, 2390, 2398, 2406, 2414, 2422, 2430, 2438, 2446, 2454, 2462, 2470, 2478, 2486, 2494, 2502, 2510, 2518, 2526, 2534, 2542, 2550, 2558, 2566, 2574, 2582, 2590, 2598, 2606, 2614, 2622, 2630, 2638, 2646, 2654, 2662, 2670, 2678, 2686, 2694, 2702, 2710, 2718, 2726, 2734, 2742]	// cell 3
				];
				
				
				if (locationType == 'DMA') {

					readTextFile("dmaData.json", function(text){
						var dmaData = JSON.parse(text);
						for (var locationList of locations) {
							for (var location of locationList) {
								var geoData = dmaData.features.filter(function(data) { 
									return data.properties.dma == location 
								});
								if (geoData.length == 1) {
									map.data.addGeoJson(geoData[0]);
								} else if (geoData.length == 0) {
									console.log('no dmas found for ' + location);
								} else {
									console.log('multiple dmas found for ' + location);
								}

							}
						}
					});

					map.data.setStyle(function(feature) {
						var dma = feature.getProperty('dma');
						var colors = ['red', 'blue', 'green'];
						for (var i = 0; i < locations.length; i++) {
							if (locations[i].includes(dma)) {
								return {
									fillColor: colors[i],
									strokeWeight: 1
								}
							}
						}
						return {
							fillColor: 'gray',
							strokeWeight: 1
						}
					});
					
				}
				
				if (locationType == 'COUNTY') {
					
// 					map.data.addGeoJson(JSON.parse('{\"type\":\"Feature\",\"geometries\":[{\"type\":\"MultiPolygon\",\"coordinates\":[[[[-122.957166000000001,49.002082399999999],[-122.957148000000004,49.009782000000001],[-122.890444000000002,49.062742999999998],[-122.890379999999993,49.091686000000003],[-122.890382000000002,49.092421000000002],[-122.890387000000004,49.098281999999998],[-122.890399000000002,49.104702000000003],[-122.890449000000004,49.111840999999998],[-122.890375000000006,49.119337999999999],[-122.890396800000005,49.119373699999997],[-122.890366,49.126714999999997],[-122.890268399999997,49.131029300000002],[-122.890266100000005,49.1325346],[-122.890266999999994,49.133523199999999],[-122.890266499999996,49.133610099999999],[-122.890355,49.134087000000001],[-122.890257599999998,49.135140499999999],[-122.890254299999995,49.135224100000002],[-122.890248200000002,49.135495800000001],[-122.890353000000005,49.141323],[-122.890358000000006,49.148580000000003],[-122.890361100000007,49.150222499999998],[-122.890361299999995,49.150343900000003],[-122.890361999999996,49.150690900000001],[-122.890362300000007,49.150860600000001],[-122.890371999999999,49.155988000000001],[-122.890359000000004,49.163209999999999],[-122.890292200000005,49.1677204],[-122.890291300000001,49.167786100000001],[-122.890252000000004,49.170437999999997],[-122.890153999999995,49.177145000000003],[-122.901169999999993,49.177126999999999],[-122.912381999999994,49.177112999999999],[-122.915450000000007,49.177104],[-122.922833999999995,49.177081000000001],[-122.914118000000002,49.19256],[-122.911698999999999,49.195732],[-122.899450999999999,49.203198999999998],[-122.895619999999994,49.205958000000003],[-122.884118999999998,49.217632999999999],[-122.877211000000003,49.219779000000003],[-122.8764556,49.219854699999999],[-122.866776999999999,49.220824999999998],[-122.855735999999993,49.220621999999999],[-122.843000000000004,49.219876999999997],[-122.805222599999993,49.220390100000003],[-122.803668999999999,49.220422999999997],[-122.795541999999998,49.216946],[-122.778856000000005,49.214230999999998],[-122.771321999999998,49.213467000000001],[-122.750938199999993,49.215262799999998],[-122.739776000000006,49.213453000000001],[-122.731123199999999,49.211565299999997],[-122.726426000000004,49.201765000000002],[-122.725947300000001,49.1986548],[-122.725424000000004,49.195253999999998],[-122.722722000000005,49.188538999999999],[-122.720453000000006,49.186629000000003],[-122.714271999999994,49.184246000000002],[-122.707606999999996,49.182958999999997],[-122.701307999999997,49.183231999999997],[-122.695611,49.18383],[-122.692201999999995,49.184255],[-122.685551000000004,49.185273000000002],[-122.679473000000002,49.187080000000002],[-122.679475999999994,49.186005000000002],[-122.679490999999999,49.176983999999997],[-122.679306999999994,49.170147999999998],[-122.679108999999997,49.162892999999997],[-122.679278999999994,49.155639999999998],[-122.679444000000004,49.148221999999997],[-122.679501000000002,49.140884999999997],[-122.679563999999999,49.133606],[-122.679829999999995,49.119075000000002],[-122.679885900000002,49.113785900000003],[-122.679903999999993,49.111699000000002],[-122.679917799999998,49.109763899999997],[-122.679956000000004,49.104399000000001],[-122.679865000000007,49.100270999999999],[-122.679807999999994,49.0976882],[-122.679794999999999,49.097101000000002],[-122.679751300000007,49.094900500000001],[-122.679719000000006,49.093279000000003],[-122.679671999999997,49.0914],[-122.679647000000003,49.090522999999997],[-122.679698000000002,49.089669000000001],[-122.679704999999998,49.089579000000001],[-122.679760000000002,49.088693999999997],[-122.679816000000002,49.087780000000002],[-122.679873000000001,49.086866000000001],[-122.679928000000004,49.085959000000003],[-122.679985000000002,49.084077999999998],[-122.679989800000001,49.083993900000003],[-122.680097000000004,49.082126000000002],[-122.680117199999998,49.081739499999998],[-122.680177999999998,49.080573000000001],[-122.680273,49.078570999999997],[-122.680319999999995,49.077688000000002],[-122.680521999999996,49.074700999999997],[-122.680515999999997,49.071691999999999],[-122.680622999999997,49.071593999999997],[-122.680623999999995,49.069310999999999],[-122.680625000000006,49.067590000000003],[-122.680625000000006,49.067481999999998],[-122.680617999999996,49.062198000000002],[-122.680615000000003,49.060211000000002],[-122.680520999999999,49.060116000000001],[-122.680488999999994,49.052891000000002],[-122.680389000000005,49.045650000000002],[-122.680333000000005,49.042152000000002],[-122.680400000000006,49.038471000000001],[-122.680350000000004,49.031185000000001],[-122.680349000000007,49.031095000000001],[-122.680143999999999,49.023927],[-122.6800997,49.0227869],[-122.6799575,49.019123100000002],[-122.679858999999993,49.016587000000001],[-122.680014999999997,49.009278999999999],[-122.680137999999999,49.0021232],[-122.691124299999998,49.002117499999997],[-122.713991800000002,49.002103599999998],[-122.7305001,49.002093600000002],[-122.735095099999995,49.002093299999999],[-122.735427999999999,49.002093199999997],[-122.735706100000002,49.002093199999997],[-122.735865000000004,49.002093100000003],[-122.736073700000006,49.002093100000003],[-122.755304499999994,49.002086400000003],[-122.755890699999995,49.002086400000003],[-122.755966099999995,49.002086200000001],[-122.756079499999998,49.002086400000003],[-122.756946499999998,49.002086400000003],[-122.7571382,49.002086400000003],[-122.757261499999998,49.002086400000003],[-122.757910499999994,49.002086300000002],[-122.786947400000003,49.002076700000003],[-122.790301999999997,49.002085700000002],[-122.790241499999993,49.016476300000001],[-122.790241100000003,49.016573100000002],[-122.790240999999995,49.016607],[-122.779259999999994,49.016581000000002],[-122.779254800000004,49.017697400000003],[-122.779193000000006,49.031059999999997],[-122.845419000000007,49.031224999999999],[-122.845441300000005,49.027898999999998],[-122.845443599999996,49.027545500000002],[-122.845444999999998,49.026544999999999],[-122.845580999999996,49.002084600000003],[-122.957166000000001,49.002082399999999]]]]}]}'));
					
					readTextFile("countyLocationOsmMapping.json", function(text) {
						var mapping = JSON.parse(text);
						for (var locationList of locations) {
							for (var location of locationList) {
								if (location in mapping) {
									readTextFile("usCountyGeoJsonData/" + mapping[location] + ".txt", function(geoJsonText) {
										var geoJsonData = JSON.parse(geoJsonText);
										
										for (var i = 0; i < geoJsonData.geometries.length; i++) {
											var newGeoJsonData = JSON.parse(JSON.stringify(geoJsonData));
											newGeoJsonData.type = 'Feature';
											newGeoJsonData.geometry = geoJsonData.geometries[i];
											delete newGeoJsonData.geometries;
											newGeoJsonData.properties = {"osmid": mapping[location], "geometryCount": i};
											map.data.addGeoJson(newGeoJsonData);
										}
										
// 										geoJsonData.type = 'Feature';
// 										geoJsonData.geometry = geoJsonData.geometries[0];
// 										delete geoJsonData.geometries;
// 										geoJsonData.properties = {"osmid": mapping[location]};
// 										map.data.addGeoJson(geoJsonData);
									});
								} else {
									console.log('location ' + location + ' not found.');
								}
							}
						}
					});
					
				}
				
			}
			
		</script>
		
	</body>

</html>
